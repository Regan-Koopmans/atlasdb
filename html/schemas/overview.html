

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Overview &mdash; OSS AtlasDB develop documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/release-notes.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tables and Indices" href="tables_and_indices.html" />
    <link rel="prev" title="Schemas" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OSS AtlasDB
          

          
          </a>

          
            
            
              <div class="version">
                develop
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Schemas</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="tables_and_indices.html">Tables and Indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="best_practices.html">Cassandra Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic_columns.html">Dynamic Columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html">Streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="cleanup_tasks.html">Cleanup Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="physical_cleanup.html">Physical Cleanup</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating_schemas.html">Schema Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="oracle_table_mapping.html">Oracle Table Mapping</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../transactions/index.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/index.html">Releases</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OSS AtlasDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Schemas</a> &raquo;</li>
        
      <li>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/schemas/overview.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<span id="schema-overview"></span><h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#background" id="id13">Background</a></li>
<li><a class="reference internal" href="#sample-schema-file" id="id14">Sample Schema File</a><ul>
<li><a class="reference internal" href="#value-types" id="id15">Value Types</a><ul>
<li><a class="reference internal" href="#primitive-valuetypes" id="id16">Primitive ValueTypes</a></li>
<li><a class="reference internal" href="#protobufs-and-persistables" id="id17">Protobufs and Persistables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schema-objects" id="id18">Schema Objects</a></li>
</ul>
</li>
</ul>
</div>
<p>This guide should give you the basics on:</p>
<ol class="arabic simple">
<li>How an AtlasDB schema file is organized.</li>
<li>What commands are available.</li>
<li>When they can be used and what they do.</li>
<li>How they translate to the underlying database.</li>
</ol>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id13">Background</a><a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Data in AtlasDB is stored as a series of key-value pairs, structured
into tables, grouped into namespaces. An AtlasDB <strong>schema</strong> defines a
set of named tables, and for each <strong>table</strong> defines the key-value pairs
which can be stored, the kind of operations which can be performed, and
any relations between tables which should be maintained. A <strong>namespace</strong>
is a named instantiation of a schema in the database. A table whose data
is explicitly derived from another table in the schema is called an
<strong>index</strong>. Indexes defined in a schema can have some of the
synchronization between the parent table and the index managed
automatically.</p>
<p>Each key-value pair in a table is actually specified by a triple: a
<strong>row</strong> part (potentially made up of several components), a <strong>column</strong>
part (potentially made up of several components), and a <strong>value</strong> part
which together form the value. The row and column together make up a
<strong>cell</strong>, which is always associated with a single value, i.e, within a
table, a cell forms a primary key. Puts and Gets on the table are done
in terms of cells; a Put of an existing cell overwrites the existing
cell and can be thought of as an update to that cell. A table is said to
contain a given row if there is at least one cell with the given row.</p>
<p>The definition of a key-value pair as a row-column-value triplet allows
for two different kinds of column layouts for a table, called “named”
columns and “dynamic” columns. In a <strong>named column</strong> layout, the columns
come from a pre-defined set of string labels, and the type of the value
can vary based on the column. In a <strong>dynamic column</strong> layout, the (sole)
column type is a tuple of values with pre-defined types. Every value in
a table with dynamic columns has the same type. One way to compare the
two layouts is that the named layout is akin to a SQL table with
primary-key and multiple columns, while the dynamic layout is akin to a
one-key-to-many-rows SQL map. Another way to compare the two layouts is
that both layout have defined rows and columns, but the named column
layout allows a row to have a subset of the named columns, whereas the
dynamic layout allows a row to have more than one full column set.</p>
<p>There are four main operations which can be conducted against an AtlasDB
table: get, getRange, put, and delete. The <strong>get</strong> operation retrieves
all cell-value pairs with the specified row values. The <strong>getRange</strong>
operation retrieves all cell-value pairs whose row values either fall
between two specified rows or begin with the specified prefix. The
<strong>put</strong> operation adds or overrides cells with new values as specified
by the operation arguments, updating any indexes needed. The <strong>delete</strong>
operation removes the specified cell-value pairs from the table.</p>
</div>
<div class="section" id="sample-schema-file">
<h2><a class="toc-backref" href="#id14">Sample Schema File</a><a class="headerlink" href="#sample-schema-file" title="Permalink to this headline">¶</a></h2>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">BlankSchema</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">BlankSchema</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">//</span><span class="n">private</span>
    <span class="p">}</span>

    <span class="n">private</span> <span class="n">static</span> <span class="n">final</span> <span class="n">Schema</span> <span class="n">SCHEMA</span> <span class="o">=</span> <span class="n">generateSchema</span><span class="p">();</span>

    <span class="n">private</span> <span class="n">static</span> <span class="n">Schema</span> <span class="n">generateSchema</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Define</span> <span class="n">the</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">package</span> <span class="k">for</span> <span class="n">generated</span> <span class="n">code</span>
        <span class="n">Schema</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Schema</span><span class="p">(</span><span class="s2">&quot;BlankSchema&quot;</span><span class="p">,</span> <span class="s2">&quot;com.palantir.atlasdb.blankschema&quot;</span><span class="p">);</span>

        <span class="o">/*</span> <span class="n">Schema</span> <span class="n">definition</span> <span class="n">start</span> <span class="o">*/</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">addTableDefinition</span><span class="p">(</span><span class="s2">&quot;TableName&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="n">TableDefinition</span><span class="p">()</span> <span class="p">{{</span>
            <span class="o">...</span>
        <span class="p">}});</span>

        <span class="n">schema</span><span class="o">.</span><span class="n">addIndexDefinition</span><span class="p">(</span><span class="s2">&quot;IndexName&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="n">IndexDefinition</span><span class="p">()</span> <span class="p">{{</span>
            <span class="o">..</span>
        <span class="p">}});</span>
        <span class="o">/*</span> <span class="n">Schema</span> <span class="n">definition</span> <span class="n">end</span> <span class="o">*/</span>

        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span> <span class="o">//</span> <span class="n">ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">schema</span> <span class="k">as</span> <span class="n">constructed</span> <span class="ow">is</span> <span class="n">valid</span><span class="o">.</span>
        <span class="k">return</span> <span class="n">schema</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span> <span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">generate</span> <span class="n">the</span> <span class="n">java</span> <span class="n">classes</span><span class="p">,</span> <span class="ow">and</span> <span class="n">write</span> <span class="n">them</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">source</span> <span class="n">folder</span><span class="o">.</span>
        <span class="n">SCHEMA</span><span class="o">.</span><span class="n">renderTablesWithNamespace</span><span class="p">(</span><span class="n">new</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">),</span> <span class="n">Namespace</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;pt_met&quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Contrary to the standard SQL format, an AtlasDB schema is written in
java, in a java class, as a sequence of calls to a schema builder and
anonymous inner classes. The java class is then run, which generates
java classes for creating, accessing, and manipulating these tables.</p>
<div class="section" id="value-types">
<h3><a class="toc-backref" href="#id15">Value Types</a><a class="headerlink" href="#value-types" title="Permalink to this headline">¶</a></h3>
<p>AtlasDB understands three kinds of data: primitive ValueTypes, protocol
buffer GeneratedMessages, and palantir Persistables.</p>
<div class="section" id="primitive-valuetypes">
<span id="id1"></span><h4><a class="toc-backref" href="#id16">Primitive ValueTypes</a><a class="headerlink" href="#primitive-valuetypes" title="Permalink to this headline">¶</a></h4>
<p>AtlasDB represents simple data types by ValueType. Note that a
Java primitive type can have multiple ValueTypes associated with it.
Each ValueType represents a different method of storing that type in the
database, and thus affects storage efficiency and search
characteristics, among other things. The supported types are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="16%" />
<col width="17%" />
<col width="19%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Java Type</th>
<th class="head">Format</th>
<th class="head">Anywhere in
row components?</th>
<th class="head">Range
Scans?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>FIXED_LONG</td>
<td>long</td>
<td>byte[8]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>FIXED_LONG_LITTLE_ENDIAN
<a class="footnote-reference" href="#id11" id="id2">[3]</a></td>
<td>long</td>
<td>byte[8]</td>
<td>YES</td>
<td>NO <a class="footnote-reference" href="#id12" id="id3">[4]</a></td>
</tr>
<tr class="row-even"><td>NULLABLE_FIXED_LONG</td>
<td>long</td>
<td>byte[9]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>VAR_LONG</td>
<td>long</td>
<td>byte[len] <a class="footnote-reference" href="#id9" id="id4">[1]</a></td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>VAR_SIGNED_LONG</td>
<td>long</td>
<td>byte[len]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>UUID</td>
<td>UUID</td>
<td>byte[16]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>SHA_256_HASH</td>
<td>Sha256Hash</td>
<td>byte[32]</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>STRING</td>
<td>String</td>
<td>byte[]</td>
<td>NO <a class="footnote-reference" href="#id10" id="id5">[2]</a></td>
<td>YES</td>
</tr>
<tr class="row-even"><td>VAR_STRING</td>
<td>String</td>
<td>byte[len]</td>
<td>YES</td>
<td>NO <a class="footnote-reference" href="#id12" id="id6">[4]</a></td>
</tr>
<tr class="row-odd"><td>BLOB</td>
<td>byte[]</td>
<td>byte[]</td>
<td>NO <a class="footnote-reference" href="#id10" id="id7">[2]</a></td>
<td>YES</td>
</tr>
<tr class="row-even"><td>SIZED_BLOB</td>
<td>byte[]</td>
<td>byte[len]</td>
<td>YES</td>
<td>NO <a class="footnote-reference" href="#id12" id="id8">[4]</a></td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[1]</a></td><td>All long data types are signed, except for <code class="docutils literal notranslate"><span class="pre">VAR_LONG</span></code>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id5">1</a>, <a class="fn-backref" href="#id7">2</a>)</em> A <code class="docutils literal notranslate"><span class="pre">STRING</span></code> or <code class="docutils literal notranslate"><span class="pre">BLOB</span></code> can only be a row component
if it is the last component of the component list.  There is schema validation
to ensure this is true.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[3]</a></td><td>This type can be useful on some key value stores because keys next
to each other won’t be written next to each other.  This can be good because
it will spread out the load of writes to many different ranges.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id6">2</a>, <a class="fn-backref" href="#id8">3</a>)</em> <p>If a type does not support range-scanning, <strong>range scans will still be available
in the API but will not behave as expected</strong>.
In particular, range-scanning will exact-match components for <code class="docutils literal notranslate"><span class="pre">VAR_STRING</span></code> and
<code class="docutils literal notranslate"><span class="pre">SIZED_BLOB</span></code> types.
For example, if you have a key with components (<code class="docutils literal notranslate"><span class="pre">VAR_STRING</span></code>, <code class="docutils literal notranslate"><span class="pre">FIXED_LONG</span></code>)
and search for prefix “ab”:</p>
<blockquote class="last">
<div><ul class="simple">
<li>(“ab”, 10) will match</li>
<li>(“ab”, 20) will match</li>
<li>(“abc”, 30) will not match</li>
</ul>
</div></blockquote>
</td></tr>
</tbody>
</table>
</div>
<div class="section" id="protobufs-and-persistables">
<h4><a class="toc-backref" href="#id17">Protobufs and Persistables</a><a class="headerlink" href="#protobufs-and-persistables" title="Permalink to this headline">¶</a></h4>
<p>For protobufs and persistables, AtlasDB will handle persisting and
hydrating objects to and from byte arrays. Otherwise, they function
similarly to ValueType.BLOB. However, for structured data it is
recommended that you store them as protobufs or persistables rather than
BLOBs - this is because AtlasDB can then extract component values from
the structs to create indexes.</p>
</div>
</div>
<div class="section" id="schema-objects">
<h3><a class="toc-backref" href="#id18">Schema Objects</a><a class="headerlink" href="#schema-objects" title="Permalink to this headline">¶</a></h3>
<p>The AtlasDB schema contains four kinds of top level objects - tables,
indexes, stream stores, and cleanup tasks.</p>
<ul class="simple">
<li><strong>Tables</strong> are the base structure for storing information in AtlasDB.
Similar to SQL tables in idea, with base layout described in the
section above.</li>
<li><strong>Indexes</strong> are tables which explicitly base their content off of a
parent table. They are useful for optimizing access patterns on a
table.</li>
<li><strong>Stream Stores</strong> store large/oversized binary data. They are similar
to SQL overflow/LOB stores.</li>
<li><strong>Cleanup Tasks</strong> are useful for cleaning up tables when the data
they reference is deleted. Similar to ON DELETE CASCADE in SQL.</li>
</ul>
<p>In this section, we’ll give you a overview of what each object does and
how to add it to a schema. Stream stores and CleanupTasks will have all
definitions explained in detail, but table/index definition will be
covered in the following section (Table/Index Definition) as it’s a much
more complicated monster.</p>
<p>NOTE: AtlasDB does not try to fully replicate a SQL language - many of
the high-level constructs (cascades, joins, etc.) are not implemented.
This is because we practically don’t have the time to replicate every
conceivable feature and philosophically want to be more explicit with
our performance than with SQL queries. Things will not map 1:1 with SQL.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="tables_and_indices.html" class="btn btn-neutral float-right" title="Tables and Indices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Schemas" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Palantir Technologies.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>